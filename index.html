<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YT Audit Pro | AI Growth Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .hero-gradient { background: radial-gradient(circle at top right, #fef2f2, transparent); }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(0,0,0,0.05); }
        
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #1f2937; }
        textarea::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        
        .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .score-bar { transition: width 1s ease-in-out; }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- CONFIGURATION ---
        const YT_API_KEY = "AIzaSyDbLyKXrNZ6CC9yp7Y6i8q9K4f0bG1KmLc"; 
        const AI_API_KEY = "AIzaSyAAitSgoxy7G6uAO9XXRy3BR4UFa8lCbng"; 
        
        const firebaseConfig = {
            apiKey: "AIzaSyAglNxobkU7c8ng1kG6WhxkdpZBTFkYBiI",
            authDomain: "yt-audit-pro-8b4c2.firebaseapp.com",
            projectId: "yt-audit-pro-8b4c2",
            storageBucket: "yt-audit-pro-8b4c2.firebasestorage.app",
            messagingSenderId: "983448409665",
            appId: "1:983448409665:web:243f06b1d37e49164758c0",
            measurementId: "G-V7VX3TWKGJ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.toggleAuthModal = (show) => document.getElementById('auth-modal')?.classList.toggle('hidden', !show);
        window.togglePaywall = (show) => document.getElementById('paywall-modal')?.classList.toggle('hidden', !show);
        
        window.copyText = (id) => {
            const area = document.getElementById(id);
            area.select();
            document.execCommand('copy');
            alert("Copied to clipboard!");
        };

        let currentUser = null;
        let userData = null;

        window.handleGoogleLogin = async () => {
            const provider = new GoogleAuthProvider();
            provider.setCustomParameters({ prompt: 'select_account' });
            try {
                await signInWithPopup(auth, provider);
                window.toggleAuthModal(false);
            } catch (err) {
                console.error("Auth Error:", err);
                alert("Login failed: " + err.message);
            }
        };

        window.handleAuth = async (type) => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const errorEl = document.getElementById('auth-error');
            try {
                if (type === 'signup') await createUserWithEmailAndPassword(auth, email, password);
                else if (type === 'login') await signInWithEmailAndPassword(auth, email, password);
                else if (type === 'reset') {
                    await sendPasswordResetEmail(auth, email);
                    alert("Check your email for the reset link!");
                }
                window.toggleAuthModal(false);
            } catch (err) {
                errorEl.innerText = err.message;
                errorEl.classList.remove('hidden');
            }
        };

        window.logout = () => signOut(auth);

        onAuthStateChanged(auth, async (user) => {
            currentUser = user;
            const authBtn = document.getElementById('auth-trigger-btn');
            const userBar = document.getElementById('user-status-bar');
            if (user) {
                authBtn?.classList.add('hidden');
                userBar?.classList.remove('hidden');
                document.getElementById('user-email-display').innerText = user.email.toUpperCase();
                
                onSnapshot(doc(db, "users", user.uid), (snapshot) => {
                    if (snapshot.exists()) {
                        userData = snapshot.data();
                        document.getElementById('credit-count').innerText = userData.plan === 'Pro' ? '∞' : (userData.credits || 0);
                        document.getElementById('plan-badge').innerText = userData.plan || 'Free';
                    } else {
                        const initialData = { email: user.email, credits: 2, plan: 'Free', createdAt: new Date() };
                        setDoc(doc(db, "users", user.uid), initialData);
                        userData = initialData;
                    }
                });
            } else {
                document.getElementById('auth-trigger-btn').classList.remove('hidden');
                document.getElementById('user-status-bar').classList.add('hidden');
                userData = null;
            }
        });

        window.performAudit = async () => {
            if (!currentUser) return window.toggleAuthModal(true);
            if (!userData) return alert("Setting up your profile...");
            if (userData.plan !== 'Pro' && (userData.credits === undefined || userData.credits <= 0)) {
                return window.togglePaywall(true);
            }

            const urlInput = document.getElementById('video-url').value;
            const match = urlInput.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
            if (!match) return alert("Please enter a valid YouTube URL.");
            
            const videoId = match[1];
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results-area').classList.add('hidden');

            try {
                const res = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics&id=${videoId}&key=${YT_API_KEY}`);
                const data = await res.json();
                
                if (data.error) throw new Error(data.error.message);
                if (!data.items?.length) throw new Error("Video not found. Is it public?");

                const videoData = data.items[0];
                const analysis = await analyzeWithAI(videoData);
                
                if (userData.plan !== 'Pro') {
                    await updateDoc(doc(db, "users", currentUser.uid), { credits: increment(-1) });
                }

                renderResults(videoData, analysis);
            } catch (err) {
                console.error(err);
                alert("Audit failed: " + err.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        };

        async function analyzeWithAI(video) {
            const systemPrompt = `You are a high-level YouTube SEO and Growth Consultant. 
            Analyze video metadata with EXTREME STRICTNESS. Be brutally honest.
            Average videos get 3-6. High quality (millions of views potential) gets 8+.

            MANDATORY JSON STRUCTURE:
            {
                "scores": { "title": 0-10, "thumbnail": 0-10, "seo": 0-10, "description": 0-10, "overall": 0-10 },
                "descriptionAnalysis": {
                    "score": 0-10,
                    "breakdown": { "hook": 0-10, "keywords": 0-10, "structure": 0-10, "cta": 0-10, "intent": 0-10 },
                    "criticalIssues": ["Issue 1", "Issue 2"],
                    "rewrittenDescription": "Full professional rewrite here..."
                },
                "titleAnalysis": { "score": 0-10, "suggestions": ["Alt Title 1", "Alt Title 2", "Alt Title 3"] },
                "thumbnailAudit": [{ "tip": "Visual Fix", "reason": "Why" }],
                "tagLab": { "hashtagCheck": "Good/Poor - why", "keywordTags": "k1, k2, k3" },
                "bilingualChecklist": [{ "en": "Step", "local": "Translation" }]
            }
            
            Focus heavily on the Description Audit:
            1. Evaluate the first 150 characters (The Hook).
            2. Check for keywords in the first 2 lines.
            3. Penalize blocky text or missing CTAs.
            4. Rewrite for maximum retention.

            Analyze:
            Title: ${video.snippet.title}
            Description: ${video.snippet.description}
            Tags: ${video.snippet.tags ? video.snippet.tags.join(', ') : 'NONE'}`;

            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${AI_API_KEY}`, {
                method: 'POST',
                body: JSON.stringify({
                    contents: [{ parts: [{ text: "Perform professional strict audit." }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: { responseMimeType: "application/json" }
                })
            });
            const json = await res.json();
            if (json.error) throw new Error("AI Service Error: " + json.error.message);
            return JSON.parse(json.candidates[0].content.parts[0].text);
        }

        function renderResults(meta, ai) {
            const thumbnail = meta.snippet.thumbnails?.high?.url || '';
            document.getElementById('vid-thumb-preview').src = thumbnail;
            document.getElementById('thumb-score-mini').innerText = `${ai.scores.thumbnail}/10`;
            document.getElementById('current-title-display').innerText = meta.snippet.title;
            
            // Description Audit Data
            document.getElementById('desc-score-badge').innerText = `${ai.descriptionAnalysis.score}/10`;
            const breakdown = ai.descriptionAnalysis.breakdown;
            document.getElementById('desc-bars').innerHTML = Object.entries(breakdown).map(([k, v]) => `
                <div class="mb-3">
                    <div class="flex justify-between text-[10px] font-bold uppercase mb-1">
                        <span>${k}</span>
                        <span>${v}/10</span>
                    </div>
                    <div class="h-1.5 w-full bg-gray-100 rounded-full overflow-hidden">
                        <div class="score-bar h-full bg-blue-600" style="width: ${v * 10}%"></div>
                    </div>
                </div>
            `).join('');

            document.getElementById('desc-issues').innerHTML = ai.descriptionAnalysis.criticalIssues.map(issue => 
                `<li class="text-red-600 flex items-start space-x-2"><i class="fa-solid fa-triangle-exclamation mt-1 text-[10px]"></i> <span>${issue}</span></li>`
            ).join('');
            
            document.getElementById('rewritten-desc-area').value = ai.descriptionAnalysis.rewrittenDescription;

            // Title/Tags/Checklist
            document.getElementById('title-suggestions-list').innerHTML = (ai.titleAnalysis.suggestions || []).map(t => 
                `<div class="bg-blue-50 p-3 rounded-lg font-bold text-blue-900 text-sm mb-2 border border-blue-100 shadow-sm">${t}</div>`
            ).join('');

            document.getElementById('copy-keywords-area').value = ai.tagLab.keywordTags || '';
            document.getElementById('hashtag-check-text').innerText = ai.tagLab.hashtagCheck;
            
            document.getElementById('bilingual-checklist').innerHTML = (ai.bilingualChecklist || []).map(item => `
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                    <p class="font-bold text-gray-800 text-sm mb-2"><i class="fa-solid fa-circle-check text-green-500 mr-2"></i>${item.en}</p>
                    <div class="pt-3 border-t border-gray-50 italic text-gray-500 text-xs">${item.local}</div>
                </div>
            `).join('');

            const scoreGrid = document.getElementById('scores-grid');
            scoreGrid.innerHTML = '';
            const labels = { title: 'Title', thumbnail: 'Visual', seo: 'SEO', description: 'Description', overall: 'Audit' };
            Object.entries(ai.scores).forEach(([k, v]) => {
                const color = v > 7 ? 'text-green-600' : v > 4 ? 'text-orange-500' : 'text-red-600';
                const bg = v > 7 ? 'bg-green-50' : v > 4 ? 'bg-orange-50' : 'bg-red-50';
                scoreGrid.innerHTML += `
                    <div class="${bg} rounded-2xl p-6 text-center border border-white shadow-sm transition-transform hover:scale-105">
                        <div class="text-3xl font-black ${color} mb-1">${v}/10</div>
                        <div class="text-[10px] uppercase font-bold text-gray-400 tracking-widest">${labels[k] || k}</div>
                    </div>
                `;
            });

            document.getElementById('results-area').classList.remove('hidden');
            document.getElementById('results-area').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</head>
<body class="bg-[#fafafa] min-h-screen hero-gradient">

    <!-- Navbar -->
    <nav class="py-4 border-b bg-white/80 sticky top-0 z-50 backdrop-blur-md">
        <div class="max-w-5xl mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="bg-red-600 p-2 rounded-lg shadow-lg shadow-red-200"><i class="fa-solid fa-chart-line text-white"></i></div>
                <span class="font-extrabold text-xl tracking-tighter">YT Audit<span class="text-red-600">Pro</span></span>
            </div>
            
            <div id="auth-trigger-btn">
                <button onclick="window.toggleAuthModal(true)" class="bg-gray-900 text-white px-6 py-2 rounded-full font-bold text-sm hover:bg-black transition-colors">Sign In</button>
            </div>

            <div id="user-status-bar" class="hidden flex items-center space-x-4">
                <div class="text-right">
                    <p id="user-email-display" class="text-[10px] font-bold text-gray-400 tracking-widest uppercase"></p>
                    <p class="text-xs font-bold">
                        <span id="credit-count" class="text-red-600">0</span> Credits • 
                        <span id="plan-badge" class="text-blue-600">Free</span>
                    </p>
                </div>
                <button onclick="window.logout()" class="text-gray-400 hover:text-red-600 transition-colors"><i class="fa-solid fa-right-from-bracket"></i></button>
            </div>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto px-4 py-12">
        <div class="text-center mb-10 fade-in-up">
            <h2 class="text-5xl font-extrabold mb-4 tracking-tight leading-tight uppercase">YouTube Video <span class="text-red-600">Analyzer</span></h2>
            <div class="text-gray-500 text-lg max-w-2xl mx-auto space-y-1">
                <p>Turn Your Youtube Video Into a Growth Engine.</p>
                <p class="text-sm font-medium">AI-powered analysis for titles, description, thumbnails, tags, and SEO.</p>
            </div>
        </div>

        <div class="glass p-2 rounded-[2.5rem] shadow-2xl flex flex-col md:flex-row gap-2 mb-16 max-w-4xl mx-auto fade-in-up">
            <div class="flex-grow flex items-center px-6">
                <i class="fa-brands fa-youtube text-red-600 text-xl mr-4"></i>
                <input type="text" id="video-url" placeholder="Paste YouTube video link here..." class="w-full py-5 bg-transparent outline-none text-lg font-medium">
            </div>
            <button onclick="window.performAudit()" class="bg-red-600 text-white px-10 py-5 rounded-[2.2rem] font-bold shadow-xl active:scale-95">Audit Video</button>
        </div>

        <div id="loading" class="hidden text-center py-20">
            <div class="animate-spin inline-block w-12 h-12 border-4 border-red-600 border-t-transparent rounded-full mb-6"></div>
            <p class="font-bold text-xl text-gray-900">Brutally auditing metadata...</p>
        </div>

        <!-- Audit Results -->
        <div id="results-area" class="hidden space-y-12 pb-20 fade-in-up">
            
            <div id="scores-grid" class="grid grid-cols-2 md:grid-cols-5 gap-4"></div>

            <!-- Description Audit -->
            <div class="glass p-10 rounded-[2.5rem] bg-white border-l-8 border-l-blue-600">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                    <div>
                        <h3 class="text-3xl font-black text-gray-900 mb-1">Description Audit</h3>
                        <p class="text-gray-400 text-sm font-medium uppercase tracking-widest">Structural & SEO Performance Evaluation</p>
                    </div>
                    <div id="desc-score-badge" class="bg-blue-600 text-white text-3xl font-black px-6 py-3 rounded-2xl shadow-lg">0/10</div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
                    <div>
                        <p class="text-[10px] font-black text-blue-600 uppercase tracking-widest mb-4">Metric Breakdown</p>
                        <div id="desc-bars"></div>
                    </div>
                    <div>
                        <p class="text-[10px] font-black text-red-600 uppercase tracking-widest mb-4">Critical Issues</p>
                        <ul id="desc-issues" class="space-y-3 text-sm font-semibold"></ul>
                    </div>
                    <div class="bg-gray-900 rounded-[2rem] p-8 text-white relative">
                        <p class="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-4">Optimized Pro Rewrite</p>
                        <textarea id="rewritten-desc-area" class="w-full h-48 bg-transparent text-xs font-medium text-gray-300 outline-none resize-none leading-relaxed" readonly></textarea>
                        <button onclick="window.copyText('rewritten-desc-area')" class="absolute top-4 right-4 text-blue-400 hover:text-white transition-colors"><i class="fa-solid fa-copy"></i></button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Title Clinic -->
                <div class="glass p-8 rounded-[2.5rem]">
                    <h3 class="font-bold text-xl mb-6 flex items-center"><i class="fa-solid fa-pen-nib text-blue-500 mr-3"></i> Title Clinic</h3>
                    <div id="current-title-display" class="p-4 bg-gray-50 rounded-xl mb-6 border text-sm font-medium italic"></div>
                    <div id="title-suggestions-list"></div>
                </div>

                <!-- Visual Audit -->
                <div class="glass p-8 rounded-[2.5rem]">
                    <h3 class="font-bold text-xl mb-6 flex items-center"><i class="fa-solid fa-eye text-red-500 mr-3"></i> Visual Audit</h3>
                    <div class="relative">
                        <img id="vid-thumb-preview" class="rounded-2xl w-full aspect-video object-cover shadow-lg border-4 border-white">
                        <div id="thumb-score-mini" class="absolute -bottom-2 -right-2 bg-red-600 text-white font-black px-3 py-1 rounded-lg text-sm shadow-lg"></div>
                    </div>
                </div>
            </div>

            <!-- Keyword Lab -->
            <div class="glass p-8 rounded-[2.5rem] bg-gray-900 text-white border-none shadow-xl shadow-gray-200">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-2xl font-extrabold text-white">Tag Lab</h3>
                    <div id="hashtag-check-text" class="text-[10px] font-black text-red-400 uppercase">Checking hashtags...</div>
                </div>
                <div class="relative">
                    <textarea id="copy-keywords-area" class="w-full h-32 bg-gray-800 border-none rounded-2xl p-6 text-sm font-mono text-gray-400 outline-none focus:ring-1 focus:ring-red-500" readonly></textarea>
                    <button onclick="window.copyText('copy-keywords-area')" class="absolute top-4 right-4 bg-red-600 text-white px-6 py-2 rounded-xl text-xs font-bold">Copy All</button>
                </div>
            </div>

            <!-- Growth Checklist -->
            <div class="glass p-8 rounded-[2.5rem] bg-gradient-to-br from-white to-green-50/50">
                <h3 class="font-bold text-2xl mb-2 uppercase tracking-tight">Growth Protocol</h3>
                <p class="text-gray-500 mb-8 font-semibold">Strict execution steps for higher retention.</p>
                <div id="bilingual-checklist" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>
        </div>
    </main>

    <!-- AUTH MODAL -->
    <div id="auth-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-10 relative shadow-2xl animate-in zoom-in duration-300">
            <button onclick="window.toggleAuthModal(false)" class="absolute top-6 right-8 text-gray-300 hover:text-gray-900"><i class="fa-solid fa-xmark text-2xl"></i></button>
            <h3 class="text-3xl font-extrabold mb-8 text-center tracking-tighter">Enter Platform</h3>
            <div class="space-y-4">
                <button onclick="window.handleGoogleLogin()" class="w-full py-4 border border-gray-200 rounded-2xl flex items-center justify-center space-x-3 font-bold text-gray-700 hover:bg-gray-50 transition-all mb-2">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" class="w-5 h-5">
                    <span>Sign in with Google</span>
                </button>
                <div class="text-center text-[10px] text-gray-300 font-bold uppercase py-2 tracking-widest">or direct access</div>
                <input type="email" id="auth-email" placeholder="Email" class="w-full p-4 bg-gray-50 rounded-2xl outline-none focus:ring-2 ring-red-500">
                <input type="password" id="auth-password" placeholder="Password" class="w-full p-4 bg-gray-50 rounded-2xl outline-none focus:ring-2 ring-red-500">
                <p id="auth-error" class="hidden text-red-500 text-xs px-2 font-bold"></p>
                <div class="grid grid-cols-2 gap-4 pt-2">
                    <button onclick="window.handleAuth('signup')" class="bg-red-600 text-white py-4 rounded-2xl font-bold">Sign Up</button>
                    <button onclick="window.handleAuth('login')" class="bg-gray-900 text-white py-4 rounded-2xl font-bold">Login</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PAYWALL -->
    <div id="paywall-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md">
        <div class="max-w-4xl w-full grid grid-cols-1 md:grid-cols-2 gap-6 animate-in slide-in-from-bottom-8 duration-500">
            <div class="bg-white rounded-[2.5rem] p-10 flex flex-col justify-between shadow-2xl relative overflow-hidden">
                <div class="bg-red-600 text-white text-[10px] font-black uppercase tracking-widest px-4 py-1 absolute top-6 right-[-30px] rotate-45 w-40 text-center">Popular</div>
                <div>
                    <h4 class="text-2xl font-bold mb-2">Premium</h4>
                    <p class="text-4xl font-black mb-6">₹100 <span class="text-sm font-normal text-gray-400">/ 10 Audits</span></p>
                </div>
                <button class="w-full py-4 bg-red-600 text-white rounded-2xl font-bold">Upgrade Now</button>
            </div>
            <div class="bg-gray-900 rounded-[2.5rem] p-10 text-white flex flex-col justify-between shadow-2xl">
                <div>
                    <h4 class="text-2xl font-bold mb-2">Pro</h4>
                    <p class="text-4xl font-black mb-6">₹3000 <span class="text-sm font-normal text-gray-500">/ month</span></p>
                </div>
                <button class="w-full py-4 bg-white text-gray-900 rounded-2xl font-bold">Go Unlimited</button>
            </div>
            <button onclick="window.togglePaywall(false)" class="col-span-full text-center text-gray-400 font-bold mt-4">Close</button>
        </div>
    </div>
</body>
</html>
